<!DOCTYPE html>
<html>
<head>
  <title>Health Dashboard</title>
  <!-- Include Bootstrap CSS, jQuery, Bootstrap JS, and Chart.js -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- Use full version of jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container mt-4">
  <h2>Health Dashboard</h2>
  <!-- Main Navigation Tabs -->
  <ul class="nav nav-tabs" id="healthTab" role="tablist">
    <li class="nav-item">
      <a class="nav-link" id="data-entry-tab" data-toggle="tab" href="#data-entry" role="tab">Data Entry</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="visualization-tab" data-toggle="tab" href="#visualization" role="tab">Visualizations</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="feedback-tab" data-toggle="tab" href="#feedback" role="tab">Feedback</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="edit-tab" data-toggle="tab" href="#edit" role="tab">Edit Entries</a>
    </li>
  </ul>
  <div class="tab-content mt-3" id="healthTabContent">
    <div class="tab-pane fade" id="data-entry" role="tabpanel">
      {% include "health/partials/data_entry.html" %}
    </div>
    <div class="tab-pane fade" id="visualization" role="tabpanel">
      {% include "health/partials/visualizations.html" %}
    </div>
    <div class="tab-pane fade" id="feedback" role="tabpanel">
      {% include "health/partials/feedback.html" %}
    </div>
    <div class="tab-pane fade" id="edit" role="tabpanel">
      {% include "health/partials/edit_entries.html" %}
    </div>
  </div>
  <p class="mt-3"><a href="{% url 'dashboard' %}">Return to Main Dashboard</a></p>
</div>
<script>
  $(document).ready(function(){
    // Debug: log the entire query string
    console.log("Query String:", window.location.search);
    var urlParams = new URLSearchParams(window.location.search);
    var activeTab = urlParams.get('active_tab');
    console.log("Active Tab from URL:", activeTab);
    if(activeTab){
      $('#healthTab a[href="#' + activeTab + '"]').tab('show');
    } else if(urlParams.get('start_date') || urlParams.get('end_date')){
      $('#healthTab a[href="#edit"]').tab('show');
    } else {
      $('#healthTab a[href="#data-entry"]').tab('show');
    }
  });
</script>
</body>
</html>
